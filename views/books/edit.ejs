<% layout("layouts/boilerplate") %>

<div class="row mt-4">
  <div class="col-8 offset-2">
    <h3 class="mb-4">Edit Book - <%= book.title %></h3>

    <form
      method="POST"
      action="/books/<%= book.isbn %>?_method=PUT"
      class="needs-validation"
      novalidate
    >
      <!-- Title -->
      <div class="mb-3">
        <label for="title" class="form-label">Title</label>
        <input
          type="text"
          class="form-control"
          name="book[title]"
          id="title"
          value="<%= book.title %>"
          required
        />
        <div class="invalid-feedback">Please enter the book title.</div>
      </div>

      <!-- ISBN -->
      <div class="mb-3">
        <label for="isbn" class="form-label">ISBN</label>
        <input
          type="text"
          class="form-control"
          name="book[isbn]"
          id="isbn"
          value="<%= book.isbn %>"
          readonly
        />
        <div class="form-text">ISBN cannot be changed.</div>
      </div>

      <!-- Year -->
      <div class="mb-3">
        <label for="year" class="form-label">Publication Year</label>
        <input
          type="number"
          class="form-control"
          name="book[publication_year]"
          id="year"
          value="<%= book.year %>"
          min="1000"
          max="2100"
          required
        />
        <div class="invalid-feedback">Please enter a valid publication year.</div>
      </div>

      <!-- Price -->
      <div class="mb-3">
        <label for="price" class="form-label">Price</label>
        <input
          type="number"
          step="0.01"
          class="form-control"
          name="book[price]"
          id="price"
          value="<%= book.price %>"
          required
        />
        <div class="invalid-feedback">Please enter the book price.</div>
      </div>

      <!-- Publisher -->
      <div class="mb-3">
        <label for="publisher" class="form-label">Publisher</label>
        <select
          name="book[publisher_name]"
          id="publisher"
          class="form-select"
          required
        >
          <% publishers.forEach(pub => { %>
            <option
              value="<%= pub.name %>"
              <%= book.publisher_name === pub.name ? "selected" : "" %>
            >
              <%= pub.name %>
            </option>
          <% }) %>
        </select>
        <div class="invalid-feedback">Please select a publisher.</div>
      </div>

      <!-- Author -->
      <div class="mb-4">
        <label for="author" class="form-label">Author</label>
        <select
          name="book[author_id]"
          id="author"
          class="form-select"
          required
        >
          <% authors.forEach(author => { %>
            <option
              value="<%= author.author_id %>"
              <%= author.author_id === currentAuthorId ? "selected" : "" %>
            >
              <%= author.name %>
            </option>
          <% }) %>
        </select>
        <div class="invalid-feedback">Please select an author.</div>
      </div>

      <div class="mb-3">
        <button type="submit" class="btn btn-primary me-2">Update Book</button>
        <a href="/books" class="btn btn-secondary">Cancel</a>
      </div>
    </form>
  </div>
</div>
